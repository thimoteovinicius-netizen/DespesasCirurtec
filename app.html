<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Despesas Cirurtec</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial, sans-serif;background:#f4f4f4;padding:15px;}
h1{text-align:center;}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px;}
input,select,button{width:100%;padding:10px;margin-top:8px;}
button{background:#1976d2;color:#fff;border:none;border-radius:6px;}
.btn-sec{background:#455a64;margin-top:5px;}
.hidden{display:none;}
.despesa{border-top:1px solid #ddd;margin-top:8px;padding-top:8px;}
</style>
</head>

<body>

<h1>Despesas Cirurtec</h1>

<!-- DATALIST MINAS GERAIS -->
<datalist id="cidades-mg">
  <option value="Belo Horizonte - MG">
  <option value="Contagem - MG">
  <option value="Betim - MG">
  <option value="Uberl√¢ndia - MG">
  <option value="Uberaba - MG">
  <option value="Juiz de Fora - MG">
  <option value="Governador Valadares - MG">
  <option value="Ipatinga - MG">
  <option value="Divin√≥polis - MG">
  <option value="Sete Lagoas - MG">
  <option value="Montes Claros - MG">
  <option value="Po√ßos de Caldas - MG">
  <option value="Varginha - MG">
  <option value="Pouso Alegre - MG">
  <option value="Patos de Minas - MG">
  <option value="Arax√° - MG">
  <option value="Ouro Preto - MG">
  <option value="Mariana - MG">
  <option value="Vi√ßosa - MG">
  <option value="Ub√° - MG">
  <option value="Muria√© - MG">
  <option value="Manhua√ßu - MG">
</datalist>

<!-- DADOS DO T√âCNICO -->
<div class="card">
  <input id="nome" placeholder="Nome do t√©cnico">
  <input id="email" type="email" placeholder="E-mail">
</div>

<!-- PER√çODO -->
<div class="card">
  <label>Data in√≠cio</label>
  <input type="date" id="dataInicio">

  <label>Data final</label>
  <input type="date" id="dataFim">

  <input type="number" id="adiantamento" placeholder="Valor do adiantamento (R$)">
</div>

<!-- TRAJETO -->
<div class="card">
  <h3>Trajeto da viagem (MG)</h3>

  <input list="cidades-mg" id="origem" placeholder="Ponto inicial">

  <button class="btn-sec" onclick="addParada()">‚ûï Adicionar parada</button>
  <div id="paradas"></div>

  <input list="cidades-mg" id="destino" placeholder="Destino final">
</div>

<!-- DESPESAS -->
<div class="card">
  <h3>Nova despesa</h3>

  <select id="categoria">
    <option value="">Categoria</option>
    <option>Alimenta√ß√£o</option>
    <option>Combust√≠vel</option>
    <option>Ped√°gios</option>
    <option>Pe√ßas</option>
    <option>Hospedagem</option>
    <option>Outros</option>
  </select>

  <input id="outrosTexto" class="hidden" placeholder="Descri√ß√£o livre">
  <input type="number" id="valorDespesa" placeholder="Valor (R$)">

  <button class="btn-sec" onclick="camera.click()">üì∏ C√¢mera</button>
  <input type="file" id="camera" accept="image/*" capture="environment" multiple hidden>

  <button class="btn-sec" onclick="galeria.click()">üñºÔ∏è Galeria</button>
  <input type="file" id="galeria" accept="image/*" multiple hidden>

  <button onclick="addDespesa()">Adicionar despesa</button>
</div>

<!-- LISTA -->
<div class="card">
  <h3>Despesas lan√ßadas</h3>
  <div id="lista"></div>
</div>

<div class="card">
  <button onclick="finalizar()">Finalizar viagem e gerar PDF</button>
</div>

<script>
let despesas=[], paradas=[];

categoria.onchange=()=> {
  outrosTexto.classList.toggle("hidden",categoria.value!=="Outros");
};

function addParada(){
  const div=document.createElement("div");
  div.innerHTML=`<input list="cidades-mg" placeholder="Cidade de parada">`;
  document.getElementById("paradas").appendChild(div);
  paradas.push(div);
}

function addDespesa(){
  if(!categoria.value || !valorDespesa.value){
    alert("Preencha categoria e valor");
    return;
  }

  const arquivos=[...camera.files,...galeria.files].map(f=>new Promise(res=>{
    const r=new FileReader();
    r.onload=e=>res(e.target.result);
    r.readAsDataURL(f);
  }));

  Promise.all(arquivos).then(imgs=>{
    despesas.push({
      categoria:categoria.value,
      descricao:outrosTexto.value,
      valor:Number(valorDespesa.value),
      imagens:imgs
    });

    lista.innerHTML+=`<div class="despesa">${categoria.value} ‚Äì R$ ${valorDespesa.value}</div>`;

    categoria.value=valorDespesa.value=outrosTexto.value="";
    camera.value=galeria.value="";
    outrosTexto.classList.add("hidden");
  });
}

function formatarData(d){
  if(!d) return "";
  const [y,m,da]=d.split("-");
  return `${da}/${m}/${y}`;
}

function finalizar(){
  const adiant=Number(adiantamento.value);
  if(isNaN(adiant)||adiant<=0){
    alert("Informe o valor do adiantamento");
    return;
  }

  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=10;

  pdf.text("Cirurtec Hospitalar LTDA",10,y);y+=6;
  pdf.text(`T√©cnico: ${nome.value}`,10,y);y+=6;
  pdf.text(`Per√≠odo: ${formatarData(dataInicio.value)} a ${formatarData(dataFim.value)}`,10,y);y+=6;
  pdf.text(`Origem: ${origem.value}`,10,y);y+=6;

  paradas.forEach((p,i)=>{
    pdf.text(`Parada ${i+1}: ${p.querySelector("input").value}`,10,y);y+=6;
  });

  pdf.text(`Destino: ${destino.value}`,10,y);y+=8;

  let total=0;
  despesas.forEach((d,i)=>{
    total+=d.valor;
    pdf.text(`${i+1}. ${d.categoria} ${d.descricao||""} ‚Äì R$ ${d.valor.toFixed(2)}`,10,y);
    y+=6;
  });

  y+=6;
  pdf.text(`Valor adiantado: R$ ${adiant.toFixed(2)}`,10,y);y+=6;
  pdf.text(`Total gasto: R$ ${total.toFixed(2)}`,10,y);y+=6;

  const saldo=adiant-total;
  pdf.text(`Saldo final: R$ ${saldo.toFixed(2)} ${saldo<0?"(NEGATIVO)":"(RESTANTE)"}`,10,y);

  pdf.save("Despesas_Cirurtec.pdf");
}
</script>

</body>
</html>
