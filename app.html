<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Despesas Cirurtec</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f4f4f4;padding:15px;}
h1{text-align:center;}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px;}
input,select,button,textarea{width:100%;padding:10px;margin-top:8px;}
button{background:#1976d2;color:#fff;border:none;border-radius:6px;}
.btn-sec{background:#455a64;}
.hidden{display:none;}
.despesa{border-top:1px solid #ddd;padding-top:6px;margin-top:6px;}
</style>
</head>

<body>

<h1>Despesas Cirurtec</h1>

<div class="card">
  <input id="nome" placeholder="Nome do técnico">
  <input id="email" type="email" placeholder="E-mail">
</div>

<div class="card">
  <input type="date" id="dataInicio">
  <input type="date" id="dataFim">
  <input type="number" id="adiantamento" placeholder="Valor do adiantamento (R$)">
</div>

<div class="card">
  <h3>Nova despesa</h3>

  <select id="categoria" onchange="controleCategoria()">
    <option value="">Categoria</option>
    <option>Alimentação</option>
    <option>Combustível</option>
    <option>Pedágios</option>
    <option>Peças</option>
    <option>Hospedagem</option>
    <option>Outros</option>
  </select>

  <select id="refeicao" class="hidden" onchange="calcularRefeicao()">
    <option value="">Tipo de refeição</option>
    <option>Café da manhã</option>
    <option>Almoço</option>
    <option>Café da tarde</option>
    <option>Jantar</option>
  </select>

  <input type="number" id="qtd" class="hidden" min="1" max="6" placeholder="Quantidade (1 a 6)" onchange="calcularRefeicao()">

  <input id="outrosTexto" class="hidden" placeholder="Nome da despesa (livre)">
  <input type="number" id="valorDespesa" placeholder="Valor (R$)">

  <button onclick="addDespesa()">Adicionar despesa</button>
</div>

<div class="card">
  <h3>Anexos da viagem</h3>
  <input type="file" id="anexos" accept="image/*" multiple>
</div>

<div class="card">
  <h3>Despesas lançadas</h3>
  <div id="lista"></div>
</div>

<div class="card">
  <button onclick="finalizar()">Finalizar e gerar PDF</button>
</div>

<script>
let despesas=[];

const valoresRefeicao={
  "Café da manhã":10,
  "Almoço":10,
  "Café da tarde":10,
  "Jantar":40
};

function controleCategoria(){
  refeicao.classList.toggle("hidden",categoria.value!=="Alimentação");
  qtd.classList.toggle("hidden",categoria.value!=="Alimentação");
  outrosTexto.classList.toggle("hidden",categoria.value!=="Outros");
  valorDespesa.readOnly=false;
  valorDespesa.value="";
}

function calcularRefeicao(){
  if(valoresRefeicao[refeicao.value] && qtd.value){
    valorDespesa.value = valoresRefeicao[refeicao.value]*qtd.value;
    valorDespesa.readOnly = true;
  }
}

function addDespesa(){
  if(!categoria.value || !valorDespesa.value) return alert("Preencha os dados");

  despesas.push({
    categoria:categoria.value,
    refeicao:refeicao.value,
    qtd:qtd.value || 1,
    valor:parseFloat(valorDespesa.value),
    outros:outrosTexto.value
  });

  lista.innerHTML+=`
    <div class="despesa">
      ${categoria.value}
      ${refeicao.value ? " - "+refeicao.value : ""}
      (${qtd.value || 1}) → R$ ${valorDespesa.value}
    </div>
  `;

  categoria.value=refeicao.value=qtd.value=valorDespesa.value=outrosTexto.value="";
  controleCategoria();
}

async function finalizar(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=15;

  pdf.text("Empresa: Cirurtec Hospitalar LTDA",10,y);y+=6;
  pdf.text(`Técnico: ${nome.value}`,10,y);y+=6;
  pdf.text(`Período: ${dataInicio.value} a ${dataFim.value}`,10,y);y+=10;

  let total=0;
  despesas.forEach(d=>{
    total+=d.valor;
    pdf.text(`${d.categoria} ${d.refeicao||""} (${d.qtd}) - R$ ${d.valor.toFixed(2)}`,10,y);
    y+=6;
  });

  y+=6;
  pdf.text(`Total gasto: R$ ${total.toFixed(2)}`,10,y);

  // anexos
  const files=[...anexos.files];
  for(const f of files){
    const img=await new Promise(r=>{
      const fr=new FileReader();
      fr.onload=e=>r(e.target.result);
      fr.readAsDataURL(f);
    });
    pdf.addPage();
    pdf.addImage(img,"JPEG",15,20,180,120);
  }

  pdf.save("Despesas_Cirurtec.pdf");
}
</script>

</body>
</html>
