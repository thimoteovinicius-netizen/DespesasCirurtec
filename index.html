<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Despesas Cirurtec v2</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial, sans-serif;background:#f4f4f4;padding:15px;}
h1{text-align:center;}
.card{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px;}
label{font-size:13px;color:#444;margin-top:10px;display:block;}
input,select,button,textarea{width:100%;padding:10px;margin-top:5px;}
textarea{resize:none;}
button{background:#1976d2;color:#fff;border:none;border-radius:6px;}
.btn-sec{background:#455a64;margin-top:5px;}
.hidden{display:none;}
.despesa{border-top:1px solid #ddd;margin-top:8px;padding-top:8px;}
.anexo{border-top:1px dashed #ccc;margin-top:10px;padding-top:10px;}
</style>
</head>

<body>

<h1>Despesas Cirurtec</h1>

<div class="card">
  <input id="nome" placeholder="Nome do t√©cnico">
  <input id="email" type="email" placeholder="E-mail">
</div>

<div class="card">
  <label>Data inicial</label>
  <input type="date" id="dataInicio">

  <label>Data final</label>
  <input type="date" id="dataFim">

  <input type="number" id="adiantamento" placeholder="Valor do adiantamento (R$)">
</div>

<div class="card">
  <h3>Nova despesa</h3>

  <select id="categoria" onchange="controleCategoria()">
    <option value="">Categoria</option>
    <option>Alimenta√ß√£o</option>
    <option>Combust√≠vel</option>
    <option>Ped√°gios</option>
    <option>Pe√ßas</option>
    <option>Hospedagem</option>
    <option>Outros</option>
  </select>

  <input id="outrosTexto" class="hidden">

  <input type="number" id="valorDespesa" placeholder="Valor (R$)">
  <button onclick="addDespesa()">Adicionar despesa</button>
</div>

<div class="card">
  <h3>Despesas lan√ßadas</h3>
  <div id="lista"></div>
</div>

<div class="card">
  <h3>Anexos (comprovantes)</h3>

  <button class="btn-sec" onclick="camera.click()">üì∏ Tirar foto</button>
  <input type="file" id="camera" accept="image/*" capture="environment" hidden>

  <button class="btn-sec" onclick="galeria.click()">üñºÔ∏è Galeria</button>
  <input type="file" id="galeria" accept="image/*" hidden>

  <div id="listaAnexos"></div>
</div>

<div class="card">
  <button onclick="finalizar()">Finalizar viagem e gerar PDF</button>
</div>

<script>
let despesas=[];
let anexos=[];

function controleCategoria(){
  outrosTexto.classList.toggle("hidden",categoria.value!=="Outros");
}

function addDespesa(){
  if(!categoria.value || !valorDespesa.value) return;

  const nomeCat = categoria.value==="Outros" && outrosTexto.value
    ? outrosTexto.value
    : categoria.value;

  despesas.push({categoria:nomeCat,valor:parseFloat(valorDespesa.value)});
  lista.innerHTML+=`<div class="despesa">${nomeCat} ‚Äì R$ ${valorDespesa.value}</div>`;

  categoria.value=valorDespesa.value=outrosTexto.value="";
  controleCategoria();
}

function processarAnexo(file){
  const r=new FileReader();
  r.onload=e=>{
    anexos.push({img:e.target.result,desc:""});
    renderAnexos();
  };
  r.readAsDataURL(file);
}

camera.onchange=()=>processarAnexo(camera.files[0]);
galeria.onchange=()=>processarAnexo(galeria.files[0]);

function renderAnexos(){
  listaAnexos.innerHTML="";
  anexos.forEach((a,i)=>{
    listaAnexos.innerHTML+=`
      <div class="anexo">
        üìé Anexo ${i+1}
        <textarea maxlength="100" placeholder="Descri√ß√£o do anexo"
          oninput="anexos[${i}].desc=this.value"></textarea>
      </div>
    `;
  });
}

function finalizar(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=15;

  pdf.text("Empresa: Cirurtec Hospitalar LTDA",10,y); y+=6;
  pdf.text(`T√©cnico: ${nome.value}`,10,y); y+=6;

  let total=0;
  despesas.forEach(d=>{
    total+=d.valor;
    pdf.text(`${d.categoria} ‚Äì R$ ${d.valor.toFixed(2)}`,10,y);
    y+=6;
  });

  pdf.text(`Total gasto: R$ ${total.toFixed(2)}`,10,y);

  if(anexos.length){
    pdf.addPage();
    y=15;
    pdf.text("Anexos:",10,y); y+=10;

    anexos.forEach(a=>{
      if(y>220){pdf.addPage();y=15;}
      pdf.addImage(a.img,"JPEG",10,y,90,65);
      y+=68;
      if(a.desc){
        pdf.text(a.desc,10,y);
        y+=10;
      }
    });
  }

  pdf.save("Despesas_Cirurtec.pdf");
}
</script>

</body>
</html>
